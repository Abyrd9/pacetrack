# Schema Scripts

This directory contains utility scripts for the `@pacetrack/schema` package.

## generate-route-definitions.ts

An async script that automatically generates the `ROUTE_DEFINITIONS` object in `src/routes-schema/index.ts` by scanning all route files in the `routes-schema/` directory.

### Features

- **Automatic Discovery**: Scans all `.ts` files in `routes-schema/` and its subdirectories
- **Validation**: Ensures each route file exports:
  - A constant ending with `_ROUTE` (e.g., `USER_CREATE_ROUTE`)
  - A type ending with `RouteResponse` (e.g., `UserCreateRouteResponse`)
- **Error Reporting**: Logs detailed errors for files that don't meet requirements
- **Auto-Update**: Updates `index.ts` with proper imports and `ROUTE_DEFINITIONS` object
- **Bun Native**: Uses Bun APIs for file operations and async processing
- **Alphabetical Sorting**: Automatically sorts imports and exports alphabetically

### Usage

```bash
# From the @pacetrack/schema package directory
bun run scripts/generate-route-definitions.ts

# Or using the npm script
npm run generate-route-definitions
```

### What it generates

The script creates an `index.ts` file like this:

```typescript
// Auto-generated by scripts/generate-route-definitions.ts
// Do not edit manually

import { USER_CREATE_ROUTE } from "./user/user.create.types";
import { ACCOUNT_GROUP_GET_ROUTE } from "./account-group/account-group.get.types";
// ... more imports

export const ROUTE_DEFINITIONS = {
  USER_CREATE_ROUTE: USER_CREATE_ROUTE,
  ACCOUNT_GROUP_GET_ROUTE: ACCOUNT_GROUP_GET_ROUTE,
  // ... more definitions
};
```

### Requirements for Route Files

Each route file must export:
1. **A route constant** with `_ROUTE` suffix:
   ```typescript
   export const USER_CREATE_ROUTE = { ... };
   ```

2. **A response type** with `RouteResponse` suffix:
   ```typescript
   export type UserCreateRouteResponse = RouteResponse<...>;
   ```

### Example Output

```
üîç Scanning routes-schema directory...
üìÅ Found 43 route files
‚úÖ Found 43 valid route files
üìù Generated ROUTE_DEFINITIONS with 43 routes
üíæ Updated /Users/.../index.ts

üìä Summary:
  ‚úÖ USER_CREATE_ROUTE (./user/user.create.types)
  ‚úÖ ACCOUNT_GROUP_GET_ROUTE (./account-group/account-group.get.types)
  ...
```

### Error Handling

If a route file is missing required exports, the script will:
- Log an error message
- Skip that file in the generation
- Continue processing other files
- Show a summary of valid vs invalid files

### Integration

This script is designed to be run:
- After adding new route files
- After removing route files
- As part of CI/CD pipelines
- Before committing changes to ensure consistency

The generated `ROUTE_DEFINITIONS` object provides a centralized registry of all route configurations that can be used for:
- Route validation
- Documentation generation
- API discovery
- Type checking

The script automatically organizes all imports and exports alphabetically for consistent, readable code output.
